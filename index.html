<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petit n Custom Calendar</title>
    <style>
        :root {
            --header-bg: #E6B8B8;
            --header-text: #ffffff;
            --week-bg: #FDF2F2;
            --today-bg: #FFF9F9;
            --today-border: #E6B8B8;
            --weekend-text: #E74C3C;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
            background: transparent;
        }

        /* æœˆæ›†å®¹å™¨ - å®Œæ•´éŸ¿æ‡‰å¼ */
        .calendar-container { 
            width: 100%;
            max-width: 500px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            container-type: inline-size;
            position: relative;
        }

        /* è¨­å®šæŒ‰éˆ• - å®Œå…¨éŸ¿æ‡‰å¼ */
        .settings-btn {
            position: absolute;
            top: clamp(12px, 3cqw, 20px);
            right: clamp(50px, 12cqw, 70px);
            background: rgba(255, 255, 255, 0.25);
            border: none;
            border-radius: 50%;
            width: clamp(28px, 6cqw, 36px);
            height: clamp(28px, 6cqw, 36px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.8rem, 3.5cqw, 1.2rem);
            transition: all 0.3s;
            z-index: 10;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(90deg);
        }

        /* è¨­å®šé¢æ¿ - éŸ¿æ‡‰å¼ */
        .settings-panel {
            position: absolute;
            top: clamp(12px, 3cqw, 20px);
            right: clamp(12px, 3cqw, 20px);
            background: white;
            border-radius: clamp(8px, 2cqw, 12px);
            padding: clamp(12px, 3cqw, 15px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 100;
            min-width: clamp(180px, 40cqw, 220px);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .settings-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .settings-title {
            font-size: clamp(0.8rem, 3cqw, 0.95rem);
            font-weight: 700;
            margin-bottom: clamp(10px, 2.5cqw, 12px);
            color: #374151;
            display: flex;
            align-items: center;
            gap: clamp(4px, 1cqw, 6px);
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: clamp(8px, 2cqw, 10px);
            margin-bottom: clamp(8px, 2cqw, 10px);
        }

        .color-picker-wrapper label {
            font-size: clamp(0.75rem, 2.5cqw, 0.85rem);
            color: #6b7280;
            flex: 1;
        }

        .color-picker-wrapper input[type="color"] {
            width: clamp(38px, 9cqw, 45px);
            height: clamp(30px, 7cqw, 35px);
            border: 2px solid #e5e7eb;
            border-radius: clamp(4px, 1.2cqw, 6px);
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .color-picker-wrapper input[type="color"]:hover {
            border-color: #9ca3af;
        }

        .settings-buttons {
            display: flex;
            gap: clamp(6px, 1.5cqw, 8px);
            margin-top: clamp(10px, 2.5cqw, 12px);
        }

        .settings-buttons button {
            flex: 1;
            padding: clamp(5px, 1.5cqw, 6px) clamp(10px, 2.5cqw, 12px);
            border: 1px solid #d1d5db;
            border-radius: clamp(4px, 1.2cqw, 6px);
            font-size: clamp(0.7rem, 2.5cqw, 0.8rem);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .settings-buttons button:hover {
            background: #f3f4f6;
        }

        .settings-buttons .close-btn {
            background: #f3f4f6;
        }

        /* è¡¨é ­ - å®Œå…¨éŸ¿æ‡‰å¼ */
        .header { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: clamp(12px, 3cqw, 20px);
            background: var(--header-bg);
            color: var(--header-text);
        }

        .header button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: clamp(28px, 6cqw, 36px);
            height: clamp(28px, 6cqw, 36px);
            color: var(--header-text);
            font-size: clamp(0.9rem, 3.5cqw, 1.2rem);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .header button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        #monthYear {
            font-weight: 800;
            font-size: clamp(0.95rem, 4.5cqw, 1.4rem);
            letter-spacing: 0.5px;
        }

        /* ä»Šæ—¥è³‡è¨Š - éŸ¿æ‡‰å¼ */
        #todayLine { 
            font-size: clamp(0.7rem, 2.8cqw, 0.9rem);
            padding: clamp(8px, 2.5cqw, 12px);
            text-align: center;
            color: #6b7280;
            border-bottom: 1px solid #f3f4f6;
        }

        /* æ˜ŸæœŸåˆ— - éŸ¿æ‡‰å¼ */
        .week-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 700;
            font-size: clamp(0.65rem, 2.5cqw, 0.85rem);
            padding: clamp(6px, 2cqw, 10px) 0;
            background: var(--week-bg);
            color: #4b5563;
        }

        /* æ—¥æœŸç¶²æ ¼ - éŸ¿æ‡‰å¼ */
        .days-grid { 
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: clamp(1px, 0.3cqw, 2px);
            padding: clamp(4px, 2cqw, 10px);
            background: #f9fafb;
        }

        .day { 
            background: #fff;
            aspect-ratio: 1/1.1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: clamp(3px, 1cqw, 6px);
            padding: clamp(2px, 1cqw, 4px);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .day:not(:empty):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* æ—¥æœŸæ•¸å­— - å®Œå…¨éŸ¿æ‡‰å¼ */
        .day-num {
            font-size: clamp(0.8rem, 3.5cqw, 1.15rem);
            font-weight: 500;
            line-height: 1.2;
        }

        /* è¾²æ›†æ–‡å­— - å®Œå…¨éŸ¿æ‡‰å¼ */
        .lunar {
            font-size: clamp(0.5rem, 2cqw, 0.72rem);
            color: #9ca3af;
            margin-top: clamp(1px, 0.5cqw, 3px);
            text-align: center;
            line-height: 1.1;
            white-space: nowrap;
        }

        /* ä»Šæ—¥æ¨£å¼ */
        .today { 
            background: var(--today-bg);
            box-shadow: inset 0 0 0 clamp(1.5px, 0.5cqw, 2px) var(--today-border);
            font-weight: bold;
        }

        .today .day-num {
            font-weight: 700;
        }

        .today:hover {
            box-shadow: inset 0 0 0 clamp(1.5px, 0.5cqw, 2px) var(--today-border),
                        0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .holiday, .weekend {
            color: var(--weekend-text);
        }

        .day:empty {
            background: transparent;
        }

        /* æ¥µå°å®¹å™¨å„ªåŒ– */
        @container (max-width: 280px) {
            .lunar {
                font-size: clamp(0.45rem, 1.8cqw, 0.55rem);
            }

            .day {
                aspect-ratio: 1/1;
            }

            .day-num {
                font-size: clamp(0.75rem, 3.2cqw, 0.9rem);
            }
        }

        /* è¶…å¤§å®¹å™¨å„ªåŒ– */
        @container (min-width: 480px) {
            .day-num {
                font-size: clamp(1.05rem, 3.5cqw, 1.2rem);
            }

            .lunar {
                font-size: clamp(0.68rem, 2cqw, 0.75rem);
            }
        }

        /* å°è¢å¹•å„ªåŒ– */
        @media (max-width: 400px) {
            body {
                padding: 5px;
            }

            .calendar-container {
                border-radius: 12px;
            }

            .settings-panel {
                right: 5px;
                top: 5px;
            }
        }

        /* è¶…å°è¢å¹• - é€²ä¸€æ­¥ç¸®å°æ–‡å­— */
        @media (max-width: 320px) {
            #monthYear {
                font-size: clamp(0.85rem, 4cqw, 1rem);
            }

            #todayLine {
                font-size: clamp(0.65rem, 2.5cqw, 0.75rem);
            }
        }
    </style>
</head>
<body>

<!-- æœˆæ›†ä¸»é«” -->
<div class="calendar-container">
    <!-- è¨­å®šæŒ‰éˆ• -->
    <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>

    <!-- è¨­å®šé¢æ¿ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-title">
            ğŸ¨ è‡ªè¨‚ä¸»é¡Œè‰²
        </div>
        <div class="color-picker-wrapper">
            <label for="mainColor">ä¸»é¡Œè‰²</label>
            <input type="color" id="mainColor" value="#E6B8B8">
        </div>
        <div class="settings-buttons">
            <button onclick="resetTheme()">é‡ç½®</button>
            <button class="close-btn" onclick="toggleSettings()">å®Œæˆ</button>
        </div>
    </div>

    <!-- æœˆæ›†è¡¨é ­ -->
    <div class="header">
        <button onclick="changeMonth(-1)">â®</button>
        <div id="monthYear"></div>
        <button onclick="changeMonth(1)">â¯</button>
    </div>
    <div id="todayLine"></div>
    <div class="week-header">
        <div class="weekend">æ—¥</div>
        <div>ä¸€</div>
        <div>äºŒ</div>
        <div>ä¸‰</div>
        <div>å››</div>
        <div>äº”</div>
        <div class="weekend">å…­</div>
    </div>
    <div id="calendarDays" class="days-grid"></div>
</div>

<script>
/* =========================================
   è‰²å½©è¨ˆç®—èˆ‡ç®¡ç†
   ========================================= */
const DEFAULT_COLOR = "#E6B8B8";

// å°‡ hex è½‰æ›ç‚º RGB
function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}

// å°‡ RGB è½‰æ›ç‚º hex
function rgbToHex(r, g, b) {
    return "#" + [r, g, b].map(x => {
        const hex = Math.round(x).toString(16);
        return hex.length === 1 ? "0" + hex : hex;
    }).join("");
}

// ç”Ÿæˆæ·ºè‰²ç‰ˆæœ¬ï¼ˆç”¨æ–¼æ˜ŸæœŸåˆ—å’Œä»Šå¤©èƒŒæ™¯ï¼‰
function getLighterShade(hex, lightness) {
    const rgb = hexToRgb(hex);
    if (!rgb) return hex;
    
    // å°‡é¡è‰²å‘ç™½è‰²æ··åˆ
    const r = rgb.r + (255 - rgb.r) * lightness;
    const g = rgb.g + (255 - rgb.g) * lightness;
    const b = rgb.b + (255 - rgb.b) * lightness;
    
    return rgbToHex(r, g, b);
}

// åˆ¤æ–·é¡è‰²æ·±æ·ºï¼Œæ±ºå®šæ–‡å­—é¡è‰²
function getContrastColor(hex) {
    const rgb = hexToRgb(hex);
    if (!rgb) return "#ffffff";
    
    // è¨ˆç®—äº®åº¦
    const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
    return brightness > 155 ? "#333333" : "#ffffff";
}

// å¾ localStorage è¼‰å…¥æˆ–ä½¿ç”¨é è¨­å€¼
function loadMainColor() {
    return localStorage.getItem('calendarMainColor') || DEFAULT_COLOR;
}

// å„²å­˜ä¸»é¡Œè‰²
function saveMainColor(color) {
    localStorage.setItem('calendarMainColor', color);
}

// å¥—ç”¨ä¸»é¡Œ
function updateTheme(mainColor) {
    const root = document.documentElement;
    
    // ä¸»é¡Œè‰²
    root.style.setProperty('--header-bg', mainColor);
    
    // æ–‡å­—é¡è‰²ï¼ˆæ ¹æ“šä¸»é¡Œè‰²æ·±æ·ºè‡ªå‹•èª¿æ•´ï¼‰
    const textColor = getContrastColor(mainColor);
    root.style.setProperty('--header-text', textColor);
    
    // æ˜ŸæœŸåˆ—èƒŒæ™¯ï¼ˆä¸»é¡Œè‰²çš„ 90% æ·ºè‰²ï¼‰
    const weekBg = getLighterShade(mainColor, 0.9);
    root.style.setProperty('--week-bg', weekBg);
    
    // ä»Šå¤©èƒŒæ™¯ï¼ˆä¸»é¡Œè‰²çš„ 95% æ·ºè‰²ï¼‰
    const todayBg = getLighterShade(mainColor, 0.95);
    root.style.setProperty('--today-bg', todayBg);
    
    // ä»Šå¤©é‚Šæ¡†ï¼ˆèˆ‡ä¸»é¡Œè‰²ç›¸åŒï¼‰
    root.style.setProperty('--today-border', mainColor);
    
    // åŒæ­¥åˆ°é¡è‰²é¸æ“‡å™¨
    document.getElementById('mainColor').value = mainColor;
    
    // æ›´æ–°è¨­å®šæŒ‰éˆ•é¡è‰²
    const settingsBtn = document.querySelector('.settings-btn');
    settingsBtn.style.color = textColor;
}

// é‡ç½®ç‚ºé è¨­é…è‰²
function resetTheme() {
    updateTheme(DEFAULT_COLOR);
    saveMainColor(DEFAULT_COLOR);
}

// åˆ‡æ›è¨­å®šé¢æ¿
function toggleSettings() {
    const panel = document.getElementById('settingsPanel');
    panel.classList.toggle('active');
}

// ç›£è½é¡è‰²è®Šæ›´
function initColorPicker() {
    document.getElementById('mainColor').addEventListener('input', (e) => {
        const color = e.target.value;
        updateTheme(color);
        saveMainColor(color);
    });
}

// é»æ“Šå¤–éƒ¨é—œé–‰è¨­å®šé¢æ¿
document.addEventListener('click', (e) => {
    const panel = document.getElementById('settingsPanel');
    const settingsBtn = document.querySelector('.settings-btn');
    
    if (!panel.contains(e.target) && !settingsBtn.contains(e.target)) {
        panel.classList.remove('active');
    }
});

let current = new Date();

/* ===== åœ‹å®šå‡æ—¥ ===== */
function getTaiwanHolidays(year) {
    return {
        [`${year}-1-1`]: "å…ƒæ—¦",
        [`${year}-2-28`]: "å’Œå¹³ç´€å¿µæ—¥",
        [`${year}-4-4`]: "å…’ç«¥ç¯€",
        [`${year}-4-5`]: "æ¸…æ˜ç¯€",
        [`${year}-10-10`]: "åœ‹æ…¶æ—¥"
    };
}

const lunarFestivals = {
    "1-1": "æ˜¥ç¯€",
    "1-15": "å…ƒå®µ",
    "5-5": "ç«¯åˆ",
    "7-7": "ä¸ƒå¤•",
    "8-15": "ä¸­ç§‹",
    "9-9": "é‡é™½"
};

const lunarDayNames = [
    "åˆä¸€", "åˆäºŒ", "åˆä¸‰", "åˆå››", "åˆäº”", "åˆå…­", "åˆä¸ƒ", "åˆå…«", "åˆä¹", "åˆå",
    "åä¸€", "åäºŒ", "åä¸‰", "åå››", "åäº”", "åå…­", "åä¸ƒ", "åå…«", "åä¹", "äºŒå",
    "å»¿ä¸€", "å»¿äºŒ", "å»¿ä¸‰", "å»¿å››", "å»¿äº”", "å»¿å…­", "å»¿ä¸ƒ", "å»¿å…«", "å»¿ä¹", "ä¸‰å"
];

// è¾²æ›†è½‰æ› (ç°¡åŒ–ç‰ˆ)
function getLunar(date) {
    const day = date.getDate();
    const month = date.getMonth() + 1;
    return {
        month: month,
        day: (day % 30) || 30
    };
}

function formatTodayLine(date) {
    const weeks = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    return `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ (æ˜ŸæœŸ${weeks[date.getDay()]})`;
}

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const today = new Date();
    const holidays = getTaiwanHolidays(year);

    document.getElementById("monthYear").textContent = `${year}å¹´ ${month + 1}æœˆ`;
    document.getElementById("todayLine").textContent = "ä»Šå¤©ï¼š" + formatTodayLine(today);

    const box = document.getElementById("calendarDays");
    box.innerHTML = "";

    let firstDay = new Date(year, month, 1).getDay();
    let lastDate = new Date(year, month + 1, 0).getDate();

    // å¡«å……ç©ºç™½
    for (let i = 0; i < firstDay; i++) {
        box.innerHTML += "<div class='day'></div>";
    }

    // å¡«å……æ—¥æœŸ
    for (let d = 1; d <= lastDate; d++) {
        const fullDate = `${year}-${month + 1}-${d}`;
        const weekDay = new Date(year, month, d).getDay();

        let cls = "day";
        if (holidays[fullDate]) cls += " holiday";
        else if (weekDay === 0 || weekDay === 6) cls += " weekend";

        if (d === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
            cls += " today";
        }

        const lunar = getLunar(new Date(year, month, d));
        const lunarText = lunarFestivals[`${lunar.month}-${lunar.day}`] ||
            (lunar.day === 1 ? `${lunar.month}æœˆ` : lunarDayNames[lunar.day - 1]);

        box.innerHTML += `
            <div class="${cls}">
                <div class="day-num">${d}</div>
                <div class="lunar">${lunarText}</div>
            </div>`;
    }
}

function changeMonth(offset) {
    current.setMonth(current.getMonth() + offset);
    renderCalendar(current);
}

// åˆå§‹åŒ–
document.addEventListener("DOMContentLoaded", () => {
    const mainColor = loadMainColor();
    updateTheme(mainColor);
    initColorPicker();
    renderCalendar(current);
});
</script>
</body>
</html>
